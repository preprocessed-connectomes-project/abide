<!DOCTYPE html>
<html>

    <head>
        <meta charset='utf-8' />
        <meta http-equiv="X-UA-Compatible" content="chrome=1" />
        <meta name="description" content="Preprocessed Connectomes Project" />

        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
	    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
        <script src="javascripts/menu_script.js"></script>
        <title>ABIDE Preprocessed</title>
    </head>

    <body>
      
        <div id="container">

        <!-- HEADER -->
            <header>
                <!--<a id="forkme_banner" href="https://github.com/ccraddock/abide_preproc">View on GitHub</a>-->

                <h1 id="project_title">ABIDE Preprocessed</h1><br>
  		        <div id='cssmenu'>
  		            <ul>
  		                <li class='active'><a href='index.html'>Overview</a></li>
                        <li class='active'><a href='download.html'>Download</a></li>
  		                <li class='active'><a href='Pipelines.html'>Pipelines</a></li>
                        <li class='active'><a href="quality_assessment.html">QA</a></li>
                        <li class='active'><a href='https://groups.google.com/d/forum/pcp_forum' target="_blank">Forum</a></li>
                        <li class='active'><a href='publications.html'>Publications</a></li>
                        <li class='active'><a href='https://preprocessed-connectomes-project.github.io' target="_blank">PCP</a></li>
  		                <li class='active'><a href='https://github.com/preprocessed-connectomes-project' target="_blank">Github</a></li>

  		            </ul>
  		        </div>
            </header>
            
                <div id="main_content_wrap" class="outer">
                    <section id="main_content" class="inner">
                        <p>This serves as a guide to:</p>

<ol>
  <li>Launch an AWS-hosted AMI with C-PAC installed and functioning</li>
  <li>Download FCP-INDI data from an AWS-hosted S3 bucket to use as input data for processing</li>
</ol>

<h1 id="1-launch-the-cpac-ami">1: Launch the CPAC AMI</h1>

<h2 id="log-in-to-ec2">Log in to EC2</h2>
<ol>
  <li>Go to <a href="http://aws.amazon.com/console/">http://aws.amazon.com/console/</a></li>
  <li>Click the <code>Sign in to the AWS Console</code> button.</li>
  <li>Enter in your AWS user email address and password and click <code>Sign in using our secure server.</code></li>
  <li>Here is the AWS console, with all the various tools Amazon offers for utilizing their web services.</li>
</ol>

<h2 id="get-our-ami">Get our AMI</h2>
<ol>
  <li>Click on the <code>EC2</code> icon. EC2 is Amazon’s cloud computing service which allows you to launch, connect to, and use virtual computing environments, called instances.</li>
  <li>Amazon has different regions that it hosts its web services from, e.g. Oregon, Northern Virginia, Tokyo, etc. In the upper right-hand corner there will be a region that you’re logged into next to your user name. Change this to N. Virginia. * Note if you’re not in the N. Virginia region, you will not find our AMI.</li>
  <li>In the left-hand column under the <code>INSTANCES</code> header, click <code>Instances</code>. This is a dashboard of all instances you currently have running on the cloud in AWS. Click the blue <code>Launch Instance</code> button.</li>
  <li>On the left-hand side of the new page, click on the <code>Community AMIs</code> tab and search <code>cpac</code> in the search text box.</li>
  <li>The <code>CPAC-OHBM-Hackathon-2014</code> AMI should appear. Hit <code>Select</code>.</li>
</ol>

<h2 id="configure-your-instance">Configure your Instance</h2>

<h3 id="hardware-specs-and-details">Hardware specs and details</h3>
<ul>
  <li>This next page is where you choose the hardware specifications for your instance. Typically, for CPAC to run effectively, at least 16GB of RAM is optimal. The m3.xlarge instance type has 15GB of RAM and 4 CPUs and functions well with CPAC. To select this type, click on the <code>General purpose</code> tab and select the <code>m3.xlarge</code> size instance. Next, click <code>Next: Configure Instance Details</code>.</li>
  <li>This page can be used to launch multiple instances from this AMI, or request Spot instances as well as other things. For now, we don’t need to do anything here, but it can be customized if desired. Next, click <code>Next: Add Storage.</code></li>
</ul>

<h3 id="storage">Storage</h3>
<ul>
  <li>Here we can change how much storage is allocated for the instance being launched. By default, it is set to 30GB. Next, click <code>Next: Tag Instance</code>.</li>
  <li>This next page we can tag the instance to give it a name as a reminder for why we launched it. Something like <code>CPAC-Demo</code> works. Click <code>Next: Configure Security Group</code>.</li>
</ul>

<h3 id="security">Security</h3>
<ul>
  <li>Here is where we can modify who has access to this instance; if you’d like to customize security and user access to the AMI, it can be done here.</li>
  <li>The default launch-wizard security group allows access for all IP addresses. If this is acceptable, Click <code>Review and Launch.</code></li>
  <li>If you’d like to be the only computer to have ssh access to the instance, you can add/change a rule for the security group that only allows a certain range of IP addresses. Change the <code>Type</code> drop down menu to <code>SSH</code> and the <code>Source</code> drop down to <code>My IP</code>; AWS will automatically read your IP address range and set the field value accordingly.</li>
</ul>

<h3 id="launch">Launch</h3>
<ol>
  <li>This final page summarizes the instance details you are about to launch. Look over everything to check your configuration</li>
  <li>Click the <code>Launch</code> button.</li>
</ol>

<h3 id="key-pair-setup">Key-pair setup</h3>
<ol>
  <li>A dialogue box opens asking about choosing a key pair for the instance. Every instance requires a key pair in order to securely login and use it. If you haven’t created a key pair yet, change the top drop down menu to <code>Create a new key pair.</code> Then name the key pair something like <code>user-cpacdemo-northva</code>. Click <code>Download Key Pair</code> and save it to your machine.</li>
  <li>Change the top drop down menu bar to <code>Choose an existing key pair</code> and select the name of the key pair you just downloaded in the bottom drop down menu. Check the acknowledgement check box and launch the instance.</li>
  <li>Click the <code>View Instances</code> blue button on the lower right of the page after to watch the instance start up.</li>
</ol>

<h2 id="using-your-instance">Using your instance</h2>
<ol>
  <li>Once it is up and running, it will display <code>2/2 checks passed</code> under the <code>Status checks</code> column.</li>
  <li>You can now ssh into the instance and use it. Click on the instance and copy the string of the instance’s <code>Public DNS</code></li>
  <li>Open a terminal and type <code>ssh -i {path/to/keypair.pem} -X ubuntu@{public-dns-of-instance-amazonaws.com}</code></li>
  <li>It will start the connection and ask if you trust the source; type <code>yes</code>.</li>
  <li>You should now be in the instance! There should be cpac related files in <code>/home/ubuntu/</code>. Feel free to launch <code>cpac_gui</code> and have at it!</li>
</ol>

<h1 id="2-download-the-abide-preprocessed-data-from-an-amazon-s3-bucket">2: Download the ABIDE Preprocessed data from an Amazon S3 bucket</h1>

<ol>
  <li>A template python script to perform the download of the preprocessed data from the FCP-INDI S3 bucket is available on <a href="https://raw.githubusercontent.com/preprocessed-connectomes-project/abide/master/get_s3_paths.py">our Github repo</a> via <code>wget</code>.</li>
  <li>Within the script, the <code>csv_path</code> string specifies the path to the phenotypic data csv file of the ABIDE preprocessed data. This file is downloadable from the <a href="https://s3.amazonaws.com/fcp-indi/data/Projects/ABIDE_Initiative/Phenotypic_V1_0b_preprocessed.csv">FCP-INDI bucket</a> via <code>wget</code>.</li>
  <li>Within the script, the <code>download_root</code> string specifies the path to the base directory for storing all of the downloaded data. Change this to suit your needs.</li>
  <li>Within the script, under line 27, is an if statement which pulls data from S3 based on subject phenotypic data. By default, the script pulls down all subjects who’s data came from ‘CALTECH’, who were male, and over the age of 30. But these conditions can be customized to pull down any desired data.</li>
  <li>Within the script, under line 35, are the <code>pipeline</code>, <code>strategy</code>, and <code>derivative</code> values. These specify the pipeline, strategy, and derivative, from which, the data was processed. By default, the script looks for the results of a CPAC-processed, globally-filtered strategy used to generate the degree-centrality derivatives.</li>
  <li>Executing the script via <code>python get_s3_paths</code> will begin the download of the files to the <code>download_root</code> directory. Enjoy!</li>
</ol>


                    </section>
                </div>
                    
            <!-- FOOTER  -->
            <footer class="inner">
                <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
            </footer>
    
        </div>  
    </body>
</html>
